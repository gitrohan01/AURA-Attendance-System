{% extends "attendance/base.html" %}
{% block title %}Fine Calculator — AURA{% endblock %}

{% block content %}
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">

    <!-- ------------------------------ -->
    <!-- MODE 1: INDIVIDUAL STUDENT -->
    <!-- ------------------------------ -->
    <div class="bg-white/5 p-6 rounded">
        <h2 class="font-semibold text-xl mb-4">Calculate Fine for a Student</h2>

        <form method="POST">
            {% csrf_token %}
            <input type="hidden" name="mode" value="student">

            <label class="block mb-1 text-gray-300">Enter Student ID</label>
            <input type="text" name="student_id" class="w-full p-2 rounded bg-white/10"
                   placeholder="STU_001" required>

            <button class="mt-3 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">
                Calculate
            </button>
        </form>

        {% if student_result %}
        <div class="mt-5 p-4 rounded bg-black/30">
            <h3 class="text-lg font-semibold">Result</h3>
            <p><b>Name:</b> {{ student_result.name }}</p>
            <p><b>Class:</b> {{ student_result.class }}</p>
            <p><b>Attendance %:</b> {{ student_result.percent }}%</p>
            <p><b>Total Sessions:</b> {{ student_result.total_sessions }}</p>
            <p><b>Present:</b> {{ student_result.present }}</p>
            <p><b>Absent Days:</b> {{ student_result.absent_days }}</p>
            <p class="mt-2 text-xl text-red-400"><b>Fine:</b> ₹{{ student_result.fine }}</p>
        </div>
        {% endif %}
    </div>

    <!-- ------------------------------ -->
    <!-- MODE 2: CLASS WISE -->
    <!-- ------------------------------ -->
    <div class="bg-white/5 p-6 rounded">
        <h2 class="font-semibold text-xl mb-4">Calculate Fine for Entire Class</h2>

        <form method="POST">
            {% csrf_token %}
            <input type="hidden" name="mode" value="class">

            <label class="block mb-1 text-gray-300">Select Class</label>
            <select name="class_id" class="w-full p-2 rounded bg-white/10" required>
                {% for c in classes %}
                <option value="{{ c.id }}">{{ c.name }}</option>
                {% endfor %}
            </select>

            <button class="mt-3 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded">
                Calculate Class Fine
            </button>
        </form>

        {% if class_results %}
        <div class="mt-5 overflow-auto max-h-96">
            <table class="min-w-full text-sm">
                <thead>
                    <tr class="text-left bg-white/10">
                        <th class="p-2">Student</th>
                        <th class="p-2">Percent</th>
                        <th class="p-2">Absent</th>
                        <th class="p-2">Fine</th>
                    </tr>
                </thead>
                <tbody>
                    {% for s in class_results %}
                    <tr class="border-b border-white/10">
                        <td class="p-2">{{ s.name }}</td>
                        <td class="p-2">{{ s.percent }}%</td>
                        <td class="p-2">{{ s.absent_days }}</td>
                        <td class="p-2 text-red-400">₹{{ s.fine }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}

    </div>

</div>
{% endblock %}
