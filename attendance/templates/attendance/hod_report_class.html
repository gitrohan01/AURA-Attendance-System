<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Class Attendance Report</title>
<style>
  body { font-family:"Inter",sans-serif; color:#222; margin:0; padding:20px; }
  .header { display:flex; align-items:center; border-bottom:2px solid #444; padding-bottom:10px; margin-bottom:20px; }
  h1 { margin:0; font-size:24px; text-transform:uppercase; }
  .meta-box { background:#f5f5f5; padding:12px; border:1px solid #ddd; border-radius:6px; margin-bottom:20px; font-size:14px; }
  table { width:100%; border-collapse:collapse; margin-top:10px; font-size:12px; }
  th, td { border:1px solid #ccc; padding:5px 6px; }
  th { background:#e8eaf6; }
  .percentage-low { color:#d32f2f; font-weight:bold; }
  .section-title { margin-top:18px; font-size:16px; font-weight:600; }
  .signature-area { margin-top:40px; font-size:14px; }
  .footer { margin-top:30px; font-size:11px; text-align:right; border-top:1px solid #ccc; padding-top:8px; }
</style>
</head>
<body>

<div class="header">
  <div>
    <h1>Class Attendance Report</h1>
    <div style="font-size:13px;">Generated by AURA Attendance System</div>
  </div>
</div>

<div class="meta-box">
  <strong>Class:</strong> {{ class_group.name }}{% if department %} — {{ department.name }}{% endif %}<br>
  <strong>Report Date:</strong> {{ report_date }}<br>
  <strong>Total Attendance Rows:</strong> {{ class_total }}<br>
  <strong>Overall Class Attendance:</strong> {{ class_percentage }}%
</div>

<h3 class="section-title">Student-wise Summary</h3>
<table>
  <thead>
    <tr>
      <th>Student ID</th>
      <th>Name</th>
      <th>Present (All)</th>
      <th>Absent (All)</th>
      <th>% (All)</th>
      <th>Present (Last 30d)</th>
      <th>Absent (Last 30d)</th>
      <th>% (Last 30d)</th>
    </tr>
  </thead>
  <tbody>
    {% for row in rows %}
    <tr>
      <td>{{ row.student.student_id }}</td>
      <td>{{ row.student.first_name }} {{ row.student.last_name }}</td>
      <td>{{ row.present }}</td>
      <td>{{ row.absent }}</td>
      <td>
        {% if row.percentage < 60 %}
          <span class="percentage-low">{{ row.percentage }}%</span>
        {% else %}
          {{ row.percentage }}%
        {% endif %}
      </td>
      <td>{{ row.present_30 }}</td>
      <td>{{ row.absent_30 }}</td>
      <td>{{ row.percentage_30 }}%</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<div class="signature-area">
  <strong>Class Teacher Signature: ____________________________</strong><br>
  <span>Date: ____________________</span><br><br>
  <strong>HOD Signature: _____________________________________</strong><br>
  <span>Date: ____________________</span>
</div>

<div class="footer">
  AURA • Class Attendance Report • {{ report_date }}
</div>

</body>
</html>
